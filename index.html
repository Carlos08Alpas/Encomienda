<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Cargo - Sistema de Gesti√≥n de Encomiendas</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Oswald:wght@500;700&display=swap" rel="stylesheet">

    <!-- Firebase SDKs (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #f8fafc; }
        h1, h2, h3, .brand-font { font-family: 'Oswald', sans-serif; }
        
        .hero-bg {
            background-image: linear-gradient(rgba(15, 23, 42, 0.85), rgba(15, 23, 42, 0.85)), url('https://images.unsplash.com/photo-1578575437130-527eed3abbec?auto=format&fit=crop&w=1600&q=80');
            background-size: cover;
            background-position: center;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            background-color: white;
            transition: all 0.2s;
        }
        .input-field:focus {
            border-color: #f97316;
            outline: none;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
        }

        .btn-primary {
            background-color: #0f172a;
            color: white;
            font-weight: 700;
            padding: 12px 24px;
            border-radius: 6px;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn-primary:hover { background-color: #1e293b; transform: translateY(-1px); }

        .hidden-screen { display: none !important; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Navbar -->
    <nav class="bg-slate-950 text-white shadow-xl sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-2">
                    <i class="fas fa-globe text-orange-500 text-2xl"></i>
                    <span class="text-xl font-bold tracking-tighter uppercase brand-font">Global Cargo</span>
                </div>
                
                <div class="flex items-center gap-4">
                    <!-- User Status Info -->
                    <div id="user-info" class="hidden text-xs text-right mr-4 md:block">
                        <p class="text-slate-400">Bienvenido,</p>
                        <p id="display-user-email" class="font-bold text-orange-400"></p>
                    </div>
                    
                    <div class="flex gap-2">
                        <button id="nav-login" onclick="showAuthScreen('login')" class="text-sm px-4 py-2 rounded hover:bg-slate-800 transition">Entrar</button>
                        <button id="nav-logout" onclick="handleLogout()" class="hidden text-sm px-4 py-2 bg-red-900/30 text-red-400 rounded hover:bg-red-900/50 transition border border-red-900/50">Salir</button>
                        <button onclick="toggleAdminPanel()" class="text-sm bg-slate-800 px-3 py-2 rounded hover:bg-slate-700 border border-slate-700">
                            <i class="fas fa-user-shield"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div id="home-hero" class="hero-bg h-[400px] flex items-center justify-center text-center px-4 transition-all">
        <div class="max-w-3xl">
            <h1 class="text-4xl md:text-6xl font-bold text-white mb-4">LOG√çSTICA SIN FRONTERAS</h1>
            <p class="text-lg text-slate-300 mb-8 font-light">Reg√≠strate para gestionar tus env√≠os internacionales con la mayor seguridad del mercado.</p>
            <button onclick="scrollToOrder()" class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-10 rounded shadow-xl transition transform hover:scale-105 uppercase">
                Empezar env√≠o ahora
            </button>
        </div>
    </div>

    <!-- Main Application -->
    <main class="flex-grow max-w-7xl mx-auto px-4 py-12 w-full">
        
        <!-- PANTALLA: AUTENTICACI√ìN (LOGIN/REGISTRO) -->
        <div id="auth-section" class="hidden-screen max-w-md mx-auto bg-white p-8 rounded-xl shadow-2xl border border-slate-100">
            <div class="text-center mb-8">
                <h2 id="auth-title" class="text-3xl font-bold text-slate-800">Iniciar Sesi√≥n</h2>
                <p id="auth-subtitle" class="text-slate-500 mt-2">Ingresa tus credenciales para continuar</p>
            </div>

            <form id="authForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-1">Correo Electr√≥nico</label>
                    <input type="email" id="auth-email" required class="input-field" placeholder="tu@correo.com">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-1">Contrase√±a</label>
                    <input type="password" id="auth-pass" required class="input-field" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                
                <button type="submit" id="auth-btn" class="w-full btn-primary mt-4">Entrar al Sistema</button>
                
                <p class="text-center text-sm text-slate-600 mt-6">
                    <span id="auth-switch-text">¬øNo tienes cuenta?</span>
                    <button type="button" onclick="toggleAuthMode()" id="auth-switch-btn" class="text-orange-600 font-bold hover:underline ml-1">Reg√≠strate aqu√≠</button>
                </p>
            </form>
        </div>

        <!-- PANTALLA: FORMULARIO DE PEDIDO (Bloqueado si no hay login) -->
        <div id="order-section" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="lg:col-span-2">
                <!-- Overlay de bloqueo -->
                <div id="order-locked" class="bg-slate-100 border-2 border-dashed border-slate-300 rounded-xl p-20 text-center">
                    <i class="fas fa-lock text-5xl text-slate-400 mb-4"></i>
                    <h3 class="text-xl font-bold text-slate-700">Acceso Restringido</h3>
                    <p class="text-slate-500 mb-6">Debes iniciar sesi√≥n o registrarte para realizar un pedido de encomienda.</p>
                    <button onclick="showAuthScreen('login')" class="btn-primary">Identificarse ahora</button>
                </div>

                <!-- Formulario Real -->
                <div id="order-unlocked" class="hidden-screen bg-white rounded-xl shadow-lg p-8 border-t-4 border-orange-500">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-slate-800 flex items-center gap-2">
                            <i class="fas fa-box-open text-orange-500"></i> Nuevo Registro de Encomienda
                        </h2>
                        <span class="text-xs bg-green-100 text-green-700 px-3 py-1 rounded-full font-bold">Sesi√≥n Activa</span>
                    </div>

                    <form id="shippingForm" class="space-y-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Columna 1: Remitente -->
                            <div class="space-y-4">
                                <h3 class="font-bold text-slate-500 uppercase text-xs tracking-widest border-b pb-2">Datos del Remitente</h3>
                                <input type="text" id="senderName" required class="input-field" placeholder="Nombre completo">
                                <input type="text" id="senderId" required class="input-field" placeholder="Documento ID / Pasaporte">
                                <input type="tel" id="senderPhone" required class="input-classic input-field" placeholder="Tel√©fono de contacto">
                            </div>
                            <!-- Columna 2: Destinatario -->
                            <div class="space-y-4">
                                <h3 class="font-bold text-slate-500 uppercase text-xs tracking-widest border-b pb-2">Datos de Destino</h3>
                                <input type="text" id="receiverName" required class="input-field" placeholder="Nombre de quien recibe">
                                <select id="destinationCountry" class="input-field">
                                    <option value="Per√∫">Per√∫ üáµüá™</option>
                                    <option value="Espa√±a">Espa√±a üá™üá∏</option>
                                    <option value="USA">USA üá∫üá∏</option>
                                    <option value="M√©xico">M√©xico üá≤üáΩ</option>
                                </select>
                                <input type="text" id="destinationCity" required class="input-field" placeholder="Ciudad de destino">
                                <input type="text" id="destinationAddress" required class="input-field" placeholder="Direcci√≥n exacta">
                            </div>
                        </div>

                        <div class="bg-slate-50 p-6 rounded-lg border border-slate-200">
                            <h3 class="font-bold text-slate-500 uppercase text-xs tracking-widest mb-4">Detalle del Paquete</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <input type="number" id="pkgWeight" step="0.1" required class="input-field" placeholder="Peso est. (kg)">
                                <input type="text" id="pkgDesc" required class="md:col-span-2 input-field" placeholder="¬øQu√© contiene el paquete?">
                            </div>
                        </div>

                        <button type="submit" id="btnSubmit" class="w-full btn-primary h-16 text-lg">
                            Registrar y Enviar Pedido
                        </button>
                        <p id="statusMsg" class="text-center font-bold hidden"></p>
                    </form>
                </div>
            </div>

            <!-- Sidebar Info -->
            <div class="space-y-6">
                <div class="bg-slate-900 text-white p-6 rounded-xl shadow-lg">
                    <h3 class="font-bold text-lg mb-4 text-orange-500 border-b border-slate-800 pb-2">Informaci√≥n de Carga</h3>
                    <p class="text-sm text-slate-400 leading-relaxed italic">
                        "Recuerda que todos los env√≠os son validados por nuestro equipo de seguridad antes de ser embarcados."
                    </p>
                    <div class="mt-6 space-y-4">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-headset text-orange-500"></i>
                            <span class="text-sm">+51 924 181 502</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                    <h4 class="font-bold text-slate-800 mb-3 text-sm">Restricciones:</h4>
                    <ul class="text-xs text-slate-500 space-y-2">
                        <li>üö´ No l√≠quidos inflamables.</li>
                        <li>üö´ No perecederos sin empaque.</li>
                        <li>üö´ No dinero en efectivo.</li>
                    </ul>
                </div>
            </div>
        </div>

    </main>

    <!-- ADMIN PANEL MODAL -->
    <div id="adminModal" class="fixed inset-0 bg-slate-900/90 z-[100] hidden flex justify-center items-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-6xl h-[90vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden">
            <div class="bg-slate-950 text-white p-6 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <i class="fas fa-database text-orange-500"></i>
                    <h2 class="text-xl font-bold uppercase brand-font">Consola de Administraci√≥n</h2>
                </div>
                <button onclick="toggleAdminPanel()" class="text-slate-400 hover:text-white text-3xl">&times;</button>
            </div>
            
            <div id="adminAuth" class="flex-grow flex flex-col justify-center items-center p-12 text-center">
                <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mb-6">
                    <i class="fas fa-shield-alt text-4xl text-slate-400"></i>
                </div>
                <h3 class="text-2xl font-bold text-slate-800">Verificaci√≥n de Identidad</h3>
                <p class="text-slate-500 mb-8">Ingresa el c√≥digo PIN para acceder al reporte maestro.</p>
                <input type="password" id="adminPin" class="border-2 border-slate-200 p-4 rounded-xl w-64 text-center text-3xl tracking-[1rem] focus:border-orange-500 outline-none transition" placeholder="****">
                <button onclick="checkPin()" class="mt-6 bg-slate-900 text-white px-10 py-3 rounded-xl font-bold hover:bg-slate-800">Acceder</button>
                <p id="pinError" class="text-red-500 text-sm mt-4 hidden">C√≥digo PIN incorrecto. Intenta de nuevo.</p>
            </div>

            <div id="adminData" class="hidden flex-col h-full bg-slate-50">
                <div class="p-6 bg-white border-b flex flex-col md:flex-row justify-between items-center gap-4">
                    <div>
                        <h4 class="text-lg font-bold text-slate-800">Historial de Encomiendas</h4>
                        <p class="text-sm text-slate-500">Gestionando <span id="recordCount" class="font-bold text-orange-600">0</span> registros globales.</p>
                    </div>
                    <button onclick="exportToCSV()" class="w-full md:w-auto bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-bold flex items-center justify-center gap-2 shadow-lg">
                        <i class="fas fa-file-csv"></i> Descargar Excel (CSV)
                    </button>
                </div>
                <div class="flex-grow overflow-auto">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Usuario Registro</th>
                                <th>Remitente</th>
                                <th>Pa√≠s Destino</th>
                                <th>Descripci√≥n</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-slate-950 text-slate-500 py-10 text-center text-xs">
        <div class="max-w-7xl mx-auto px-4">
            <p class="mb-2">¬© 2024 Global Cargo International - Registro de Operadores Autorizados</p>
            <p>Este sistema est√° protegido por leyes de seguridad inform√°tica internacional.</p>
        </div>
    </footer>

    <script type="module">
        // --- CONFIGURACI√ìN E INICIALIZACI√ìN ---
        let db = null;
        let auth = null;
        let currentUser = null;
        let appId = typeof __app_id !== 'undefined' ? __app_id : 'global-cargo-app';
        let useLocalStorage = false;
        let authMode = 'login'; // 'login' o 'signup'

        try {
            if (typeof __firebase_config !== 'undefined' && __firebase_config) {
                const firebaseConfig = JSON.parse(__firebase_config);
                const app = firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
                
                // Listener de autenticaci√≥n
                auth.onAuthStateChanged(user => {
                    currentUser = user;
                    updateUIState();
                });
            } else {
                throw new Error("No config");
            }
        } catch (e) {
            console.warn("Modo Demo Activado");
            useLocalStorage = true;
            updateUIState();
        }

        // --- MANEJO DE INTERFAZ ---

        function updateUIState() {
            const locked = document.getElementById('order-locked');
            const unlocked = document.getElementById('order-unlocked');
            const navLogin = document.getElementById('nav-login');
            const navLogout = document.getElementById('nav-logout');
            const userInfo = document.getElementById('user-info');
            const displayEmail = document.getElementById('display-user-email');

            if (currentUser || (useLocalStorage && localStorage.getItem('demo_session'))) {
                const email = currentUser ? currentUser.email : localStorage.getItem('demo_session');
                locked.classList.add('hidden-screen');
                unlocked.classList.remove('hidden-screen');
                navLogin.classList.add('hidden-screen');
                navLogout.classList.remove('hidden-screen');
                userInfo.classList.remove('hidden');
                displayEmail.textContent = email;
                document.getElementById('auth-section').classList.add('hidden-screen');
                document.getElementById('home-hero').classList.remove('hidden-screen');
            } else {
                locked.classList.remove('hidden-screen');
                unlocked.classList.add('hidden-screen');
                navLogin.classList.remove('hidden-screen');
                navLogout.classList.add('hidden-screen');
                userInfo.classList.add('hidden');
            }
        }

        window.showAuthScreen = (mode) => {
            authMode = mode;
            document.getElementById('home-hero').classList.add('hidden-screen');
            document.getElementById('auth-section').classList.remove('hidden-screen');
            updateAuthFormUI();
            window.scrollTo(0, 0);
        };

        window.toggleAuthMode = () => {
            authMode = authMode === 'login' ? 'signup' : 'login';
            updateAuthFormUI();
        };

        function updateAuthFormUI() {
            const title = document.getElementById('auth-title');
            const btn = document.getElementById('auth-btn');
            const switchBtn = document.getElementById('auth-switch-btn');
            const switchText = document.getElementById('auth-switch-text');

            if (authMode === 'login') {
                title.textContent = "Iniciar Sesi√≥n";
                btn.textContent = "Entrar al Sistema";
                switchText.textContent = "¬øNo tienes cuenta?";
                switchBtn.textContent = "Reg√≠strate aqu√≠";
            } else {
                title.textContent = "Crear Cuenta";
                btn.textContent = "Registrarme ahora";
                switchText.textContent = "¬øYa tienes cuenta?";
                switchBtn.textContent = "Inicia sesi√≥n";
            }
        }

        window.scrollToOrder = () => {
            document.getElementById('order-section').scrollIntoView({ behavior: 'smooth' });
        };

        // --- L√ìGICA DE AUTENTICACI√ìN ---

        const authForm = document.getElementById('authForm');
        authForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-pass').value;
            const btn = document.getElementById('auth-btn');
            
            btn.disabled = true;
            btn.textContent = authMode === 'login' ? "Entrando..." : "Creando cuenta...";

            if (useLocalStorage) {
                // Simulaci√≥n LocalStorage
                localStorage.setItem('demo_session', email);
                // Si es registro, guardar el "usuario"
                if (authMode === 'signup') {
                    const users = JSON.parse(localStorage.getItem('app_users') || '[]');
                    users.push({ email, pass });
                    localStorage.setItem('app_users', JSON.stringify(users));
                }
                setTimeout(() => location.reload(), 500);
                return;
            }

            try {
                if (authMode === 'login') {
                    await auth.signInWithEmailAndPassword(email, pass);
                } else {
                    await auth.createUserWithEmailAndPassword(email, pass);
                }
                location.reload();
            } catch (err) {
                alert("Error de autenticaci√≥n: " + err.message);
                btn.disabled = false;
                btn.textContent = "Intentar de nuevo";
            }
        });

        window.handleLogout = () => {
            if (useLocalStorage) {
                localStorage.removeItem('demo_session');
                location.reload();
            } else {
                auth.signOut().then(() => location.reload());
            }
        };

        // --- L√ìGICA DE PEDIDOS ---

        const shippingForm = document.getElementById('shippingForm');
        shippingForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btnSubmit');
            const status = document.getElementById('statusMsg');
            
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Registrando datos...';

            const userEmail = currentUser ? currentUser.email : localStorage.getItem('demo_session');
            
            const orderData = {
                userEmail: userEmail,
                createdAt: new Date().toISOString(),
                sender: {
                    name: document.getElementById('senderName').value,
                    id: document.getElementById('senderId').value,
                    phone: document.getElementById('senderPhone').value
                },
                receiver: {
                    name: document.getElementById('receiverName').value,
                    country: document.getElementById('destinationCountry').value,
                    city: document.getElementById('destinationCity').value,
                    address: document.getElementById('destinationAddress').value
                },
                package: {
                    weight: document.getElementById('pkgWeight').value,
                    desc: document.getElementById('pkgDesc').value
                },
                status: 'Pendiente'
            };

            try {
                if (useLocalStorage) {
                    const orders = JSON.parse(localStorage.getItem('orders_db') || '[]');
                    orderData.id = 'ORD-' + Math.random().toString(36).substr(2, 9).toUpperCase();
                    orders.push(orderData);
                    localStorage.setItem('orders_db', JSON.stringify(orders));
                } else {
                    await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('orders').add({
                        ...orderData,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }

                status.textContent = "‚úÖ PEDIDO REGISTRADO EXITOSAMENTE";
                status.className = "text-center text-green-600 font-bold mt-4 block p-3 bg-green-50 rounded border border-green-200";
                shippingForm.reset();
                setTimeout(() => status.classList.add('hidden'), 5000);

            } catch (err) {
                alert("Error al guardar: " + err.message);
            } finally {
                btn.disabled = false;
                btn.textContent = "Registrar y Enviar Pedido";
            }
        });

        // --- ADMIN PANEL ---

        window.toggleAdminPanel = () => {
            const modal = document.getElementById('adminModal');
            modal.classList.toggle('hidden');
            document.getElementById('adminAuth').classList.remove('hidden');
            document.getElementById('adminData').classList.add('hidden');
            document.getElementById('adminPin').value = '';
        };

        window.checkPin = () => {
            const pin = document.getElementById('adminPin').value;
            if (pin === "1234") {
                document.getElementById('adminAuth').classList.add('hidden');
                document.getElementById('adminData').classList.remove('hidden');
                document.getElementById('adminData').style.display = 'flex';
                loadAdminOrders();
            } else {
                document.getElementById('pinError').classList.remove('hidden');
                setTimeout(() => document.getElementById('pinError').classList.add('hidden'), 2000);
            }
        };

        let currentOrders = [];

        async function loadAdminOrders() {
            const tbody = document.getElementById('tableBody');
            const count = document.getElementById('recordCount');
            tbody.innerHTML = '<tr><td colspan="6" class="text-center p-8 text-slate-400">Consultando base de datos...</td></tr>';
            currentOrders = [];

            try {
                if (useLocalStorage) {
                    currentOrders = JSON.parse(localStorage.getItem('orders_db') || '[]');
                    currentOrders.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                } else {
                    const snap = await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('orders').limit(100).get();
                    snap.forEach(doc => {
                        const d = doc.data();
                        const date = d.createdAt && d.createdAt.seconds ? new Date(d.createdAt.seconds * 1000).toISOString() : new Date().toISOString();
                        currentOrders.push({ id: doc.id, ...d, createdAt: date });
                    });
                    currentOrders.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                }

                tbody.innerHTML = '';
                count.textContent = currentOrders.length;

                if (currentOrders.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="text-center p-8 text-slate-400 italic">No hay registros almacenados.</td></tr>';
                    return;
                }

                currentOrders.forEach(ord => {
                    const row = document.createElement('tr');
                    const date = new Date(ord.createdAt).toLocaleDateString();
                    row.innerHTML = `
                        <td class="text-xs font-mono text-slate-500">${date}</td>
                        <td class="font-bold text-slate-700">${ord.userEmail}</td>
                        <td class="text-slate-600">${ord.sender.name}</td>
                        <td><span class="bg-orange-100 text-orange-700 px-2 py-1 rounded text-xs font-bold">${ord.receiver.country}</span></td>
                        <td class="text-xs italic text-slate-500">${ord.package.desc}</td>
                        <td><span class="text-blue-600 font-bold text-xs uppercase">${ord.status}</span></td>
                    `;
                    tbody.appendChild(row);
                });

            } catch (err) {
                tbody.innerHTML = `<tr><td colspan="6" class="text-center p-8 text-red-500">Error: ${err.message}</td></tr>`;
            }
        }

        window.exportToCSV = () => {
            if (currentOrders.length === 0) return alert("Nada para exportar.");

            let csv = "ID,Fecha,Usuario_Registro,Remitente,Tel_Remitente,Destinatario,Pais,Ciudad,Direccion,Peso_KG,Contenido,Estado\n";
            currentOrders.forEach(o => {
                const date = new Date(o.createdAt).toLocaleDateString();
                const row = [
                    o.id || 'N/A', date, o.userEmail, 
                    `"${o.sender.name}"`, o.sender.phone, 
                    `"${o.receiver.name}"`, o.receiver.country, `"${o.receiver.city}"`, `"${o.receiver.address}"`,
                    o.package.weight, `"${o.package.desc}"`, o.status
                ].join(",");
                csv += row + "\n";
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.setAttribute("download", "reporte_santech_encomiendas.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

    </script>
</body>
</html>

